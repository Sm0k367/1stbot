<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <title>Smoke Stream Omnibot ðŸš¬ðŸ’¨</title>
  <link rel="stylesheet" href="style.css" />
  
  <!-- Three.js from CDN (free, reliable, cached globally) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
  
  <!-- Meta tags for better sharing / PWA feel -->
  <meta name="description" content="Futuristic 3D chat interface powered by local browser AI (web-llm) â€“ completely free, no API keys." />
  <meta name="theme-color" content="#0a0014" />
  <link rel="icon" href="data:,"> <!-- placeholder; add real favicon later if desired -->
</head>
<body>
  <div id="branding" style="position: fixed; top: 10px; left: 20px; z-index: 15; color: #00FF41; font-family: 'Orbitron', monospace; font-size: 24px; text-shadow: 0 0 20px #00FF41; animation: glow 2s infinite;">
    Smoke Stream Omnibot ðŸš¬ðŸ’¨
  </div>

  <!-- Add control buttons -->
  <div id="controls" style="position: fixed; bottom: 80px; right: 20px; z-index: 15; display: flex; gap: 10px;">
    <button id="voice-btn" title="Voice Input">ðŸŽ¤</button>
    <button id="camera-btn" title="Camera">ðŸ“¹</button>
    <button id="upload-btn" title="Upload File">ðŸ“Ž</button>
  </div>

  <div id="scene-container"></div>
  
  <div id="chat-container">
    <div id="chat-messages"></div>
    <div id="input-area">
      <input type="file" id="file-input" accept="image/*" style="display: none;" />
      <input type="text" id="user-input" placeholder="Type your message..." autocomplete="off" />
      <button id="send-btn">Send</button>
    </div>
    <div id="status">Initializing cosmic interface...</div>
  </div>

  <!-- Cross-Origin Isolation for SharedArrayBuffer / web-llm -->
  <script>
    // Add event listeners
    document.getElementById('voice-btn').addEventListener('click', toggleVoice);
    document.getElementById('camera-btn').addEventListener('click', toggleCamera);
    document.getElementById('upload-btn').addEventListener('click', () => document.getElementById('file-input').click());
    document.getElementById('file-input').addEventListener('change', (e) => {
      Array.from(e.target.files).forEach(handleFileUpload);
    });

    // PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/coi-serviceworker.js');
    }
  </script>

  <!-- Main app logic (ESM module) -->
  <script type="module" src="main.js"></script>

  <!-- Fallback if JS is disabled -->
  <noscript>
    <div style="position: fixed; inset: 0; background: #000; color: #fff; display: flex; align-items: center; justify-content: center; text-align: center; padding: 20px; z-index: 9999;">
      <div>
        <h1>JavaScript is required</h1>
        <p>This is a 3D AI chat experience that needs JavaScript enabled.<br>
        Please enable JS in your browser settings and refresh the page.</p>
      </div>
    </div>
  </noscript>

  <style>
    @keyframes glow {
      0%, 100% { text-shadow: 0 0 20px #00FF41; }
      50% { text-shadow: 0 0 40px #8B00FF, 0 0 60px #00FF41; }
    }

    @media (max-width: 768px) {
      #branding { font-size: 18px; left: 10px; }
      #controls { bottom: 100px; right: 10px; flex-wrap: wrap; }
    }
  </style>
</body>
</html>